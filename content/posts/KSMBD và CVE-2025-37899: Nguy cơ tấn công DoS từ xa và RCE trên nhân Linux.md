---
title: "KSMBD và CVE-2025-37899: Nguy cơ tấn công DoS từ xa và RCE trên nhân Linux"
date: 2025-09-18T12:59:03.141+07:00
draft: false
tags: ["CVE", "KSMBD", "Linux Kernel", "DoS", "RCE", "SMB3", "Use-After-Free", "Kernel Exploit", "Vulnerability"]
categories: ["Cyber Security", "Software Tool"]
---

## Lỗ hổng nghiêm trọng CVE-2025-37899: Nguy cơ tấn công DoS từ xa và RCE trên nhân Linux

Mối lo ngại về an ninh mạng luôn hiện hữu, đặc biệt khi các lỗ hổng nghiêm trọng được phát hiện trong nhân hệ điều hành. Gần đây, một lỗ hổng đáng chú ý với mã định danh **CVE-2025-37899** đã được công bố trong thành phần **KSMBD** của nhân Linux. Điều đặc biệt là lỗ hổng này đã được phát hiện thông qua sự hỗ trợ của trí tuệ nhân tạo (AI), mở ra khả năng tấn công Từ chối Dịch vụ (DoS) từ xa và thậm chí là Thực thi Mã Từ xa (RCE) với đặc quyền kernel. Bài viết này sẽ phân tích chi tiết bản chất, mức độ nghiêm trọng và các biện pháp ứng phó cần thiết đối với CVE-2025-37899.

![Phân tích lỗ hổng CVE-2025-37899 trong KSMBD](/images/2025/CVE-2025-37899.webp)


### KSMBD là gì?

**KSMBD** là một triển khai của giao thức Server Message Block (SMB) phiên bản 3 (SMB3) trực tiếp trong nhân Linux. SMB3 là một giao thức chia sẻ tệp phổ biến, cho phép các hệ thống trong cùng một mạng truy cập tệp và máy in một cách hiệu quả. Việc KSMBD được tích hợp vào kernel nhằm mục đích cải thiện hiệu suất và khả năng mở rộng so với các triển khai SMB truyền thống ở không gian người dùng như Samba.

### Chi tiết về CVE-2025-37899: Lỗi Use-After-Free

CVE-2025-37899 được phân loại là một lỗi **use-after-free (UAF)**. Đây là một dạng lỗ hổng bộ nhớ nguy hiểm, xảy ra khi một chương trình cố gắng truy cập vào bộ nhớ đã được giải phóng.

**Cơ chế hoạt động của lỗ hổng này như sau:**

1.  **Race Condition:** Lỗi phát sinh từ một tình huống "race condition" (điều kiện tranh chấp) trong KSMBD. Điều kiện này xảy ra khi nhiều luồng thực thi (threads) cùng cố gắng truy cập và thao tác trên cùng một tài nguyên (trong trường hợp này là đối tượng `sess->user`) mà không có cơ chế đồng bộ hóa phù hợp.
2.  **Giải phóng và truy cập đồng thời:**
    *   Một luồng xử lý lệnh logoff (`smb2_session_logoff()`) và giải phóng đối tượng `sess->user`.
    *   Cùng lúc đó, một luồng khác vẫn đang cố gắng truy cập vào đối tượng `sess->user` đã bị giải phóng này.
3.  **Memory Corruption:** Việc truy cập vào bộ nhớ đã được giải phóng dẫn đến tình trạng sai lệch bộ nhớ (memory corruption). Kẻ tấn công có thể lợi dụng điều này để ghi đè dữ liệu, điều khiển luồng thực thi của chương trình.

**Hậu quả:** Tình trạng sai lệch bộ nhớ này tạo điều kiện cho kẻ tấn công thực thi mã tùy ý trên nhân Linux (Remote Code Execution - RCE) hoặc gây sập dịch vụ (Denial of Service - DoS) thông qua việc khai thác truy cập trái phép vào bộ nhớ đã giải phóng [N1].

### Mức độ nghiêm trọng và tác động

*   **Mức độ nghiêm trọng:** CVE-2025-37899 được đánh giá là một lỗ hổng **nghiêm trọng (High severity)**. Mặc dù chưa có điểm CVSS chính thức, nhưng khả năng gây ra RCE với quyền kernel khiến nó trở thành một rủi ro đáng kể [N1].
*   **Khả năng tấn công từ xa:** Lỗ hổng này có thể bị khai thác từ xa qua mạng. Kẻ tấn công trên cùng mạng (hoặc qua internet nếu dịch vụ KSMBD được công khai) có thể gửi các gói SMB3 độc hại để kích hoạt lỗ hổng, gây sập dịch vụ hoặc chiếm quyền kiểm soát kernel [N1].
*   **Tình trạng hiện tại:**
    *   Tính đến tháng 5/2025, các bản vá đã được tích hợp vào một số phiên bản nhân Linux mới hơn. Tuy nhiên, việc phân phối rộng rãi các bản vá chính thức tới tất cả các bản phân phối Linux (như SUSE đang nghiên cứu và thử nghiệm) có thể chưa hoàn chỉnh [N1].
    *   Chưa có bằng chứng về việc lỗ hổng này đã bị khai thác trong thực tế (in the wild), và cũng chưa có mã khai thác công khai. Mặc dù vậy, rủi ro vẫn rất lớn do tiềm năng thực thi mã kernel hoặc DoS từ xa [N1].

### So sánh với các lỗ hổng SMB khác (ví dụ: SMBGhost - CVE-2020-0796)

Để hiểu rõ hơn về bối cảnh của CVE-2025-37899, chúng ta có thể so sánh nó với các lỗ hổng SMB trước đây, chẳng hạn như SMBGhost (CVE-2020-0796) trên Windows.

| Đặc điểm           | CVE-2025-37899 (KSMBD)                                 | SMBGhost (CVE-2020-0796)                                   |
| :----------------- | :----------------------------------------------------- | :--------------------------------------------------------- |
| **Nền tảng**       | Linux kernel (thành phần KSMBD)                        | Windows (SMBv3)                                            |
| **Loại lỗ hổng**   | Use-After-Free, Race Condition                         | Lỗi tràn bộ đệm (Integer Overflow) trong xử lý nén dữ liệu |
| **Giao thức**      | SMB3                                                   | SMBv3                                                      |
| **Tác động**       | DoS từ xa, Thực thi mã từ xa với quyền kernel          | DoS, Thực thi mã từ xa với quyền SYSTEM                    |
| **Bản chất**       | Đều là lỗ hổng trong triển khai giao thức SMB          |                                                            |
| **Khả năng khai thác** | Có thể bị tấn công từ xa qua mạng                   | Có thể bị tấn công từ xa qua mạng                          |

Cả hai lỗ hổng đều cho thấy mức độ nguy hiểm của các vấn đề trong triển khai giao thức chia sẻ tệp, có thể dẫn đến hậu quả nghiêm trọng như mất kiểm soát hệ thống.

### Đề xuất ứng phó và giảm thiểu

Với tình trạng hiện tại của CVE-2025-37899, việc chủ động ứng phó là rất quan trọng:

*   **Theo dõi bản vá:**
    *   Theo dõi sát sao các thông báo và bản vá bảo mật từ nhà cung cấp phân phối Linux mà bạn đang sử dụng (ví dụ: Ubuntu, Red Hat, SUSE).
    *   Áp dụng các bản vá ngay khi chúng được phát hành.
*   **Vô hiệu hóa KSMBD (nếu không sử dụng):**
    *   Nếu hệ thống Linux của bạn không sử dụng KSMBD để chia sẻ tệp SMB3, hãy cân nhắc vô hiệu hóa hoặc gỡ bỏ dịch vụ này để loại bỏ hoàn toàn nguy cơ [N1].
    *   Kiểm tra trạng thái của KSMBD bằng lệnh:
        
```bash
        sudo systemctl status ksmbd
        ```

    *   Nếu đang chạy và bạn muốn vô hiệu hóa:
        
```bash
        sudo systemctl stop ksmbd
        sudo systemctl disable ksmbd
        ```

*   **Giới hạn truy cập mạng:**
    *   Nếu KSMBD là cần thiết, hãy hạn chế quyền truy cập vào dịch vụ này từ các mạng không đáng tin cậy bằng cách sử dụng tường lửa. Chỉ cho phép các địa chỉ IP hoặc dải IP cần thiết được kết nối.
    *   Ví dụ với `ufw`:
        
```bash
        sudo ufw allow from 192.168.1.0/24 to any port 445 comment 'Allow SMB from local network'
        sudo ufw enable
        ```

*   **Cập nhật hệ thống định kỳ:** Đảm bảo hệ điều hành và các gói phần mềm luôn được cập nhật phiên bản mới nhất.

### Kết luận

Lỗ hổng CVE-2025-37899 trong KSMBD là một lời nhắc nhở về tầm quan trọng của việc duy trì an ninh cho các thành phần cốt lõi của hệ điều hành. Khả năng bị tấn công DoS từ xa và RCE với quyền kernel khiến nó trở thành mối đe dọa đáng kể. Bằng cách theo dõi thông tin cập nhật, áp dụng các bản vá kịp thời và triển khai các biện pháp bảo mật chủ động, chúng ta có thể giảm thiểu rủi ro và bảo vệ hệ thống Linux của mình khỏi các cuộc tấn công tiềm tàng.

### Nguồn tham khảo

*   [N1] Intrucept Labs. "Linux Kernel Exploitation in ksmbd (CVE-2025-37899) Discovered with AI Assistance". Truy cập: [https://intruceptlabs.com/2025/05/linux-kernel-exploitation-in-ksmbd-cve-2025-37899-discovered-with-ai-assistance/](https://intruceptlabs.com/2025/05/linux-kernel-exploitation-in-ksmbd-cve-2025-37899-discovered-with-ai-assistance/)
*   [N2] WhiteHat. "Hơn một trăm nghìn máy tính vẫn bị ảnh hưởng bởi lỗ hổng SMBGhost". Truy cập: [https://whitehat.vn/threads/hon-mot-tram-nghin-may-tinh-van-bi-anh-huong-boi-lo-hong-smbghost.14175/](https://whitehat.vn/threads/hon-mot-tram-nghin-may-tinh-van-bi-anh-huong-boi-lo-hong-smbghost.14175/)
*   [N3] Hoplon Infosec. "CVE-2025-37899 ksmbd use-after-free exploit technique". Truy cập: [https://hoploninfosec.com/ksmbd-use-after-free-exploit-technique/](https://hoploninfosec.com/ksmbd-use-after-free-exploit-technique/)
