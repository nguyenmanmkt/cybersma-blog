---
title: "KSMBD: Lỗ hổng CVE-2025-37899 - Nguy cơ DoS từ xa và Thực thi mã lệnh Kernel"
date: 2025-11-01T07:02:38.034+07:00
draft: false
tags: ["ksmbd", "Linux kernel", "CVE-2025-37899", "use-after-free", "RCE", "DoS", "SMB protocol", "zero-day", "vulnerability"]
categories: ["Cyber Security", "AI Data"]
---

### Mở đầu: Lời cảnh báo từ trái tim của Linux

Trong thế giới an ninh mạng, lỗ hổng zero-day luôn là mối đe dọa nghiêm trọng nhất, đặc biệt khi chúng nhắm vào các thành phần cốt lõi của hệ điều hành. KSMBD, triển khai máy chủ SMB trong nhân Linux, gần đây đã bị phát hiện có một lỗ hổng nghiêm trọng: CVE-2025-37899. Lỗ hổng "use-after-free" này không chỉ mở ra cánh cửa cho các cuộc tấn công từ chối dịch vụ (DoS) mà còn tiềm ẩn nguy cơ thực thi mã từ xa (RCE) với đặc quyền cấp nhân. Điều đáng chú ý là lỗ hổng này được phát hiện với sự hỗ trợ của mô hình ngôn ngữ lớn (LLM) OpenAI o3, đánh dấu một cột mốc quan trọng trong việc ứng dụng AI vào săn lùng lỗ hổng bảo mật.

### KSMBD và bản chất của lỗ hổng "use-after-free"

KSMBD là một mô-đun trong nhân Linux cung cấp khả năng chia sẻ tệp theo giao thức SMB3 trực tiếp từ nhân, nhằm cải thiện hiệu suất so với các máy chủ SMB không gian người dùng như Samba. Tuy nhiên, việc thực thi trong không gian nhân cũng đồng nghĩa với việc các lỗ hổng có thể gây ra hậu quả nghiêm trọng hơn.

Lỗ hổng CVE-2025-37899 tồn tại trong hàm `smb2_session_logoff()` của KSMBD. Khi một yêu cầu đăng xuất được xử lý, đối tượng `sess->user` sẽ được giải phóng. Vấn đề phát sinh khi giao thức SMB3 cho phép nhiều kết nối được ràng buộc với cùng một phiên làm việc. Nếu một luồng thực hiện giải phóng `sess->user` trong quá trình đăng xuất, trong khi một luồng khác vẫn đang tham chiếu đến nó, điều này sẽ dẫn đến lỗi "use-after-free" cổ điển. Việc thiếu đồng bộ hóa hoặc cơ chế đếm tham chiếu phù hợp khiến việc truy cập vào vùng nhớ đã được giải phóng có thể gây ra lỗi hỏng bộ nhớ hoặc cho phép thực thi mã từ xa với đặc quyền cấp nhân.

### Tác động và khả năng khai thác

Lỗ hổng này được đánh giá là nghiêm trọng vì khả năng dẫn đến thực thi mã từ xa ở cấp độ nhân, đặt toàn bộ hệ thống vào rủi ro. Kẻ tấn công có thể lợi dụng lỗi này để:

*   **Thực thi mã từ xa (RCE):** Với đặc quyền cấp nhân, kẻ tấn công có thể chiếm toàn quyền kiểm soát hệ thống, cài đặt backdoor, đánh cắp dữ liệu nhạy cảm hoặc phá hoại hoạt động.
*   **Tấn công từ chối dịch vụ (DoS):** Gây ra sự cố hệ thống hoặc làm sập máy chủ KSMBD, ảnh hưởng đến tính khả dụng của dịch vụ chia sẻ tệp.

Việc khai thác lỗ hổng này đòi hỏi kỹ thuật cao và thời gian chính xác để kích hoạt việc truy cập đồng thời vào vùng nhớ đã được giải phóng. Tuy nhiên, sự tồn tại của các bằng chứng khái niệm (PoC) khai thác đã làm tăng rủi ro thực tế cho các máy chủ chưa được vá.

**Các hệ thống bị ảnh hưởng:**

Chỉ những hệ thống sử dụng mô-đun nhân `ksmbd` để chia sẻ tệp SMB mới bị ảnh hưởng. Các hệ thống sử dụng máy chủ SMB không gian người dùng như Samba không bị ảnh hưởng trực tiếp bởi lỗ hổng này.

### Phát hiện và biện pháp khắc phục

Điểm đặc biệt của CVE-2025-37899 là nó được phát hiện thông qua mô hình ngôn ngữ lớn o3 của OpenAI, cho thấy tiềm năng của AI trong việc phân tích mã nguồn và xác định các lỗ hổng bảo mật.

**Biện pháp khắc phục:**

*   **Cập nhật ngay lập tức:** Các quản trị viên hệ thống được khuyến cáo nên cập nhật nhân Linux lên các phiên bản đã vá lỗi (ví dụ: Linux kernels 6.12.27, 6.14.5, 6.15-rc4 và các phiên bản mới hơn) ngay lập tức. Các bản vá tập trung vào việc bổ sung đồng bộ hóa phù hợp để ngăn chặn các luồng truy cập đồng thời vào các đối tượng phiên đã được giải phóng.
*   **Tắt KSMBD:** Nếu mô-đun KSMBD không cần thiết, hãy tắt nó để giảm thiểu bề mặt tấn công, đặc biệt trên các hệ thống tiếp xúc với mạng không đáng tin cậy.
*   **Giám sát và kiểm kê:** Thường xuyên kiểm kê các hệ thống đang triển khai KSMBD và giám sát các hoạt động bất thường.

### Kết luận

CVE-2025-37899 là một lời nhắc nhở rõ ràng về tầm quan trọng của việc duy trì các hệ thống được cập nhật và cảnh giác cao độ trước các mối đe dọa bảo mật mới. Lỗ hổng "use-after-free" trong KSMBD không chỉ đặt ra nguy cơ nghiêm trọng về RCE cấp nhân mà còn là một ví dụ điển hình về việc AI đang ngày càng trở thành công cụ mạnh mẽ trong lĩnh vực an ninh mạng. Việc chủ động vá lỗi và áp dụng các biện pháp phòng ngừa là vô cùng cần thiết để bảo vệ hệ thống Linux khỏi các cuộc tấn công tiềm tàng.

## Nguồn tham khảo
[1] CVE-2025-37899. (n.d.). NVD. Truy cập từ: https://nvd.nist.gov/vuln/detail/CVE-2025-37899
[2] Remote Zero-day Linux Kernel Flaw Discovered Using AI. (2025, May 26). LinuxSecurity.com. Truy cập từ: https://linuxsecurity.com/news/security-vulnerabilities/remote-zero-day-linux-kernel-flaw-discovered-using-ai
[3] How I Used O3 to Find CVE-2025-37899, A Remote Zeroday Vulnerability in the Linux Kernel’s SMB Implementation. (2025, May 22). Sean Heelan. Truy cập từ: https://sean.heelan.io/2025/05/22/how-i-used-o3-to-find-cve-2025-37899-a-remote-zeroday-vulnerability-in-the-linux-kernels-smb-implementation/
[4] ksmbd use-after-free exploit technique. (2025, October 8). Hoplon Infosec. Truy cập từ: https://hoploninfosec.com/ksmbd-use-after-free-exploit-technique/