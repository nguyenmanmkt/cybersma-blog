---
title: "Giám sát máy chủ Windows với Grafana"
date: 2024-09-13T10:56:55.419+07:00
draft: false
tags: ["monitoring", "grafana", "windows", "prometheus", "wmi_exporter"]
categories: ["Cyber Security","Software & Tool"]
---

Grafana là một nền tảng phân tích và trực quan hóa dữ liệu mã nguồn mở, cho phép bạn tạo các dashboard tương tác để theo dõi hiệu suất và trạng thái của hệ thống. Trong bài viết này, chúng ta sẽ tìm hiểu cách sử dụng Grafana để giám sát các máy chủ Windows.

![Grafana Dashboard](https://mysoly.nl/wp-content/uploads/2024/01/visualization-and-monitoring-with-grafana-an-introductory-guide.jpg "Hình 1: Giao diện Grafana Dashboard")


### 1. Giới thiệu về giám sát máy chủ Windows

Giám sát máy chủ Windows là quá trình thu thập và phân tích dữ liệu về hiệu suất và trạng thái của máy chủ, bao gồm sử dụng CPU, bộ nhớ, lưu lượng mạng, và dung lượng ổ cứng. Việc giám sát này giúp chúng ta phát hiện sớm các vấn đề tiềm ẩn, tối ưu hóa hiệu suất và đảm bảo tính ổn định của hệ thống.

### 2. Các công cụ cần thiết

Để giám sát máy chủ Windows với Grafana, chúng ta cần các công cụ sau:

*   **Prometheus**: Một hệ thống giám sát và cảnh báo mã nguồn mở. Prometheus sẽ thu thập dữ liệu từ máy chủ Windows.
*   **WMI Exporter**: Một exporter cho phép Prometheus thu thập các metrics từ Windows Management Instrumentation (WMI).
*   **Grafana**: Nền tảng trực quan hóa dữ liệu. Grafana sẽ hiển thị dữ liệu thu thập được từ Prometheus.

### 3. Cài đặt và cấu hình Prometheus

1.  **Tải Prometheus**: Truy cập trang [Prometheus Downloads](https://prometheus.io/download/) và tải phiên bản phù hợp với hệ điều hành của bạn.
2.  **Cài đặt Prometheus**: Giải nén file đã tải và cấu hình file `prometheus.yml`.
    ```yaml
    global:
      scrape_interval:     15s
      evaluation_interval: 15s

    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']

      - job_name: 'windows'
        static_configs:
          - targets: ['<windows_server_ip>:9182']
    ```
    Thay `<windows_server_ip>` bằng địa chỉ IP của máy chủ Windows bạn muốn giám sát.

3.  **Khởi động Prometheus**: Chạy file thực thi `prometheus.exe`.

### 4. Cài đặt và cấu hình WMI Exporter

1.  **Tải WMI Exporter**: Truy cập trang [WMI Exporter Releases](https://github.com/prometheus-community/windows_exporter/releases) và tải phiên bản mới nhất.
2.  **Cài đặt WMI Exporter**: Giải nén file đã tải và chạy file `windows_exporter.exe`. Bạn có thể cài đặt nó như một service của Windows.

    ```powershell
    .\windows_exporter.exe --collectors.enabled cpu,memory,net,disk --telemetry.port 9182 --log.level error
    ```

3.  **Cấu hình Firewall**: Mở port 9182 trên Windows Firewall để Prometheus có thể truy cập WMI Exporter.

### 5. Cài đặt và cấu hình Grafana

1.  **Tải Grafana**: Truy cập trang [Grafana Downloads](https://grafana.com/grafana/download) và tải phiên bản phù hợp với hệ điều hành của bạn.
2.  **Cài đặt Grafana**: Làm theo hướng dẫn cài đặt trên trang chủ của Grafana.
3.  **Khởi động Grafana**: Truy cập `http://localhost:3000` (hoặc địa chỉ và port bạn cấu hình) và đăng nhập bằng tài khoản mặc định (admin/admin).
4.  **Thêm Data Source**:
    *   Vào `Configuration` -> `Data Sources`.
    *   Chọn `Prometheus`.
    *   Nhập địa chỉ Prometheus server (ví dụ: `http://localhost:9090`).
    *   Lưu và kiểm tra kết nối.
5.  **Nhập Dashboard**: Tìm kiếm dashboard phù hợp trên [Grafana Dashboards](https://grafana.com/grafana/dashboards){style="color:blue;"} hoặc tự tạo dashboard mới. Một số dashboard phổ biến cho giám sát Windows là:
    *   ID: `10464` ([Windows Server by Alessandro Cagnazzo](https://grafana.com/grafana/dashboards/10464){style="color:blue;"})
    *   ID: `11531` ([Windows Server Monitoring](https://grafana.com/grafana/dashboards/11531){style="color:blue;"})

![Grafana Dashboard cho Windows](https://grafana.com/api/dashboards/11531/images/image "Hình 2: Dashboard Grafana cho Windows")

### 6. Tạo Dashboard tùy chỉnh

Bạn có thể tạo dashboard tùy chỉnh để hiển thị các metrics quan trọng nhất đối với bạn. Ví dụ:

*   **CPU Usage**: Sử dụng query `avg by (instance) (rate(process_cpu_seconds_total{job="windows"}[5m])) * 100`
*   **Memory Usage**: Sử dụng query `windows_memory_available_bytes / windows_memory_total_bytes * 100`
*   **Disk Usage**: Sử dụng query `(windows_logical_disk_free_bytes{instance=~"$hostname",volume="C:"} / windows_logical_disk_size_bytes{instance=~"$hostname",volume="C:"}) * 100`

### 7. Cảnh báo

Grafana cho phép bạn thiết lập các cảnh báo dựa trên các ngưỡng giá trị của metrics. Khi một metric vượt quá ngưỡng, Grafana sẽ gửi thông báo qua email, Slack, hoặc các kênh khác.

## Kết luận:

Giám sát máy chủ Windows với Grafana, Prometheus và WMI Exporter là một giải pháp hiệu quả để theo dõi hiệu suất và trạng thái của hệ thống. Bằng cách thu thập và trực quan hóa dữ liệu, bạn có thể phát hiện sớm các vấn đề, tối ưu hóa hiệu suất và đảm bảo tính ổn định của hệ thống.

## Table of Contents
- [Mở đầu](#mở-đầu)
- [Nội dung chính](#nội-dung-chính)
- [Kết luận](#kết-luận)
```
