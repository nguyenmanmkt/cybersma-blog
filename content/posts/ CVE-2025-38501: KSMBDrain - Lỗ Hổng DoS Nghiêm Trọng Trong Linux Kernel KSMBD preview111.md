---
title: "CVE-2025-38501: KSMBDrain - Lỗ Hổng DoS Nghiêm Trọng Trong Linux Kernel KSMBD"
date: 2025-09-17T17:14:11.188+07:00
draft: false
tags: ["KSMBD", "CVE-2025-38501", "KSMBDrain", "DoS", "Denial of Service", "Linux Kernel", "SMB", "Remote Attack", "Server Security"]
categories: ["Cyber Security", "Software Tool"]
---

![KSMBD Vulnerability](/images/2025/ksmbd-vulnerability.png)

Hệ thống tệp chia sẻ là một phần không thể thiếu của hạ tầng mạng hiện đại, và Server Message Block (SMB) là một trong những giao thức phổ biến nhất cho mục đích này. Trên Linux, KSMBD đã trở thành một thành phần quan trọng, cung cấp khả năng chia sẻ tệp SMB3 ngay trong không gian kernel. Tuy nhiên, sự tiện lợi này đi kèm với những rủi ro bảo mật tiềm ẩn. Gần đây, một lỗ hổng DoS từ xa nghiêm trọng mang tên **KSMBDrain (CVE-2025-38501)** đã được phát hiện, có khả năng làm tê liệt các máy chủ Linux chạy KSMBD.

Bài viết này sẽ đi sâu vào chi tiết của KSMBDrain, cách thức hoạt động của nó, các phiên bản bị ảnh hưởng và những bước bạn cần thực hiện để bảo vệ hệ thống của mình.

## KSMBD là gì?

KSMBD là một daemon kernel Linux, được tích hợp vào nhân Linux từ phiên bản 5.3, nhằm triển khai giao thức SMB3. Mục tiêu chính của KSMBD là cung cấp hiệu suất cao hơn và tích hợp sâu hơn với hệ điều hành bằng cách thực hiện các chức năng SMB trực tiếp trong không gian kernel, thay vì trong không gian người dùng như Samba. Điều này giúp giảm thiểu độ trễ và tăng thông lượng cho các hoạt động chia sẻ tệp qua mạng [N1].

## Lỗ hổng CVE-2025-38501: KSMBDrain

CVE-2025-38501, còn được gọi là **KSMBDrain**, là một lỗ hổng loại Denial of Service (DoS) từ xa ảnh hưởng đến các máy chủ Linux sử dụng KSMBD [N2, N3, N4]. Lỗ hổng này cho phép kẻ tấn công làm cạn kiệt tài nguyên kết nối TCP của máy chủ KSMBD, khiến các yêu cầu hợp pháp không thể thiết lập kết nối và truy cập dịch vụ.

### Cách thức hoạt động

KSMBDrain khai thác cách KSMBD xử lý các kết nối TCP. Kẻ tấn công có thể khởi tạo một lượng lớn các quy trình bắt tay ba bước (three-way handshake) của TCP nhưng không hoàn thành chúng. Theo mặc định, máy chủ sẽ giữ các kết nối "half-open" (bán mở) này vô thời hạn, hoặc trong một khoảng thời gian rất dài (thời gian chờ tối thiểu cấu hình được là 1 phút), làm cạn kiệt số lượng khe kết nối tối đa có sẵn. Khi tất cả các khe kết nối bị chiếm dụng, máy chủ KSMBD không thể chấp nhận bất kỳ kết nối mới nào từ các máy khách hợp pháp, dẫn đến tình trạng từ chối dịch vụ hoàn toàn [N2, N3, N4].

**Điểm đáng chú ý:**

*   **Không cần xác thực:** Lỗ hổng này có thể bị khai thác mà không yêu cầu bất kỳ hình thức xác thực nào, khiến nó trở nên đặc biệt nguy hiểm và dễ khai thác [N2, N4].
*   **Dễ thực hiện:** Kẻ tấn công chỉ cần gửi liên tục các yêu cầu bắt tay TCP không hoàn chỉnh để gây ra sự cố.
*   **PoC có sẵn:** Một bằng chứng khái niệm (Proof-of-Concept - PoC) khai thác công khai đã có sẵn, làm tăng mức độ rủi ro và sự cấp bách của việc khắc phục [N2, N3].

### Tác động

Khi bị khai thác thành công, KSMBDrain sẽ khiến máy chủ Linux chạy KSMBD không thể cung cấp dịch vụ chia sẻ tệp SMB cho người dùng hợp pháp, dẫn đến gián đoạn hoạt động kinh doanh và mất khả năng truy cập tài nguyên quan trọng. Đây là một mối đe dọa nghiêm trọng đối với bất kỳ hệ thống nào phụ thuộc vào KSMBD.

### Các phiên bản bị ảnh hưởng

Lỗ hổng này có mặt trong **Linux Kernel phiên bản 5.3 trở lên**, tức là tất cả các phiên bản kernel mà KSMBD đã được hợp nhất vào mainline [N2, N3, N4].

## Kiểm tra và Khắc phục

### 1. Kiểm tra phiên bản Kernel

Để xác định xem hệ thống của bạn có bị ảnh hưởng hay không, hãy kiểm tra phiên bản kernel hiện tại:


```bash
uname -r
```


Nếu phiên bản kernel của bạn là 5.3 trở lên và KSMBD đang chạy, hệ thống của bạn có nguy cơ bị tấn công.

### 2. Giải pháp chính thức: Cập nhật Kernel

Cách hiệu quả nhất để khắc phục lỗ hổng này là cập nhật lên phiên bản kernel Linux đã vá lỗi. Bản vá cụ thể giải quyết vấn đề này là commit `e6bb9193974059ddbb0ce7763fa3882bd60d4dc3`, thay đổi cách KSMBD xử lý các kết nối TCP không hoàn chỉnh [N2, N4].

Các nhà cung cấp bản phân phối Linux sẽ sớm phát hành các bản cập nhật kernel chứa bản vá này. Hãy đảm bảo bạn theo dõi và áp dụng các bản cập nhật hệ thống càng sớm càng tốt.

### 3. Biện pháp phòng ngừa tạm thời

Trong khi chờ đợi bản vá kernel chính thức hoặc nếu việc cập nhật kernel không thể thực hiện ngay lập tức, bạn có thể áp dụng một số biện pháp tạm thời để giảm thiểu rủi ro:

*   **Giám sát kết nối TCP:** Thường xuyên giám sát số lượng kết nối TCP đến máy chủ KSMBD. Sự gia tăng đột biến của các kết nối "half-open" có thể là dấu hiệu của một cuộc tấn công.
*   **Giới hạn tỷ lệ kết nối (Connection Rate Limiting):** Cấu hình tường lửa hoặc thiết bị mạng để giới hạn số lượng kết nối TCP mới có thể được thiết lập đến máy chủ KSMBD trong một khoảng thời gian nhất định.
*   **Thiết lập thời gian chờ kết nối (Connection Timeouts):** Mặc dù KSMBD có thời gian chờ mặc định khá dài, bạn có thể cấu hình thời gian chờ ngắn hơn cho các kết nối TCP không hoạt động. Tuy nhiên, cần lưu ý rằng thời gian chờ tối thiểu cấu hình được vẫn là 1 phút, điều này có thể không đủ để ngăn chặn hoàn toàn cuộc tấn công DoS quy mô lớn [N2, N3].

## Phân biệt với các lỗ hổng KSMBD khác

Điều quan trọng là phải phân biệt CVE-2025-38501 với các lỗ hổng KSMBD khác đã biết. Ví dụ, **CVE-2022-47939** là một lỗ hổng nghiêm trọng khác trong KSMBD cho phép thực thi mã từ xa (Remote Code Execution - RCE) mà không cần xác thực [N5, N6]. Mặc dù cả hai đều liên quan đến KSMBD và có mức độ nghiêm trọng cao, nhưng chúng là hai lỗ hổng riêng biệt với cơ chế khai thác và tác động khác nhau. **CVE-2025-38501 là lỗ hổng DoS hiện tại** mà chúng ta đang thảo luận.

## Kết luận

Lỗ hổng KSMBDrain (CVE-2025-38501) là một mối đe dọa thực tế và nghiêm trọng đối với bất kỳ hệ thống Linux nào sử dụng KSMBD. Với sự tồn tại của PoC công khai và khả năng khai thác từ xa không cần xác thực, việc cập nhật kernel Linux lên phiên bản đã vá lỗi là ưu tiên hàng đầu. Trong thời gian chờ đợi, việc triển khai các biện pháp phòng ngừa tạm thời như giám sát và giới hạn kết nối là rất cần thiết để bảo vệ hệ thống của bạn khỏi các cuộc tấn công từ chối dịch vụ. Luôn cảnh giác và cập nhật thông tin bảo mật mới nhất để duy trì một môi trường hoạt động an toàn và ổn định.

## Nguồn tham khảo

*   [N1] SonicWall Blog. (2023, February 10). *Linux Kernel ksmbd Integer Underflow Vulnerability*. [https://www.sonicwall.com/blog/linux-kernel-ksmbd-integer-underflow-vulnerability](https://www.sonicwall.com/blog/linux-kernel-ksmbd-integer-underflow-vulnerability)
*   [N2] SecurityOnline.info. (2025, September 17). *Linux Kernel Flaw Allows Remote DoS Attacks, PoC Available*. [https://securityonline.info/ksmbdrain-cve-2025-38501-linux-kernel-flaw-allows-remote-dos-attacks-poc-available/](https://securityonline.info/ksmbdrain-cve-2025-38501-linux-kernel-flaw-allows-remote-dos-attacks-poc-available/)
*   [N3] GBHackers. (2025, September 17). *Linux Kernel KSMBD Flaw Lets Remote Attackers Drain Server Connection Resources*. [https://gbhackers.com/linux-kernel-ksmbd-flaw/](https://gbhackers.com/linux-kernel-ksmbd-flaw/)
*   [N4] Openwall oss-security. (2025, September 15). *[CVE-2025-38501] Linux kernel: KSMBD service DoS by TCP handshake*. [https://www.openwall.com/lists/oss-security/2025/09/15/2](https://www.openwall.com/lists/oss-security/2025/09/15/2)
*   [N5] Wiz.io Blog. (2022, December 27). *CVE-2022-47939 critical vulnerability in Linux kernel `ksmbd` module*. [https://www.wiz.io/blog/cve-2022-47939-critical-vulnerability-linux-kernel-ksmbd-module-everything-you-ne](https://www.wiz.io/blog/cve-2022-47939-critical-vulnerability-linux-kernel-ksmbd-module-everything-you-ne)
*   [N6] NY.gov. (2022, December 27). *A Vulnerability in KSMBD for Linux Could Allow for Remote Code ...*. [https://its.ny.gov/2022-147](https://its.ny.gov/2022-147)