---
title: "Giám Sát Máy Chủ Windows Với Grafana: Hướng Dẫn Chi Tiết Với WMI Exporter và Prometheus"
date: 2025-09-13T12:37:40.485+07:00
draft: false
tags: ["monitoring", "grafana", "windows", "prometheus", "wmi-exporter", "hướng-dẫn", "security"]
categories: ["Khoa học", "An ninh mạng", "DevOps"]
---

![Giám sát máy chủ Windows với Grafana](https://i.ytimg.com/vi/jlvh08DV9zE/maxresdefault.jpg)

Trong bối cảnh hạ tầng công nghệ thông tin ngày càng phức tạp, việc giám sát hiệu suất và trạng thái của các máy chủ là cực kỳ quan trọng để đảm bảo hoạt động liên tục và ổn định. Đặc biệt đối với các hệ thống Windows, việc thu thập và trực quan hóa dữ liệu hiệu suất đôi khi gặp nhiều thách thức. Bài viết này sẽ cung cấp một hướng dẫn chi tiết về cách thiết lập hệ thống giám sát cho máy chủ Windows bằng sự kết hợp mạnh mẽ của **Prometheus** để thu thập dữ liệu, **WMI Exporter (nay là windows_exporter)** để trích xuất metrics từ Windows, và **Grafana** để trực quan hóa các dữ liệu đó thành các biểu đồ và dashboard dễ hiểu. Mục tiêu là giúp bạn xây dựng một giải pháp giám sát toàn diện, cung cấp cái nhìn sâu sắc về sức khỏe và hiệu suất của máy chủ Windows trong thời gian thực.

### 1. Cài đặt WMI Exporter (windows_exporter) trên Máy chủ Windows của bạn

**Mục đích**: `windows_exporter` là một công cụ giúp phơi bày các số liệu hiệu suất của Windows (CPU, bộ nhớ, ổ đĩa, mạng, v.v.) qua giao thức HTTP, để Prometheus có thể thu thập chúng.

**Các bước thực hiện**:
- Tải xuống trình cài đặt MSI mới nhất từ trang GitHub Releases của [windows_exporter](https://github.com/prometheus-community/windows_exporter/releases). Ví dụ: `windows_exporter-0.28.1-amd64.msi`.
- Chạy trình cài đặt hoặc cài đặt từ PowerShell. Để đảm bảo thu thập đầy đủ các metrics cần thiết, bạn có thể chỉ định các collector khi cài đặt hoặc cấu hình sau:


```powershell
windows_exporter.exe --collectors.enabled="cpu,cs,iis,logical_disk,net,os,service,system,textfile" --web.listen-address=":9182"
```


- Mở **Services** (services.msc) và xác nhận rằng dịch vụ `windows_exporter` đang chạy.

![WMI Exporter Service Running](https://support.boldreports.com/kb/article/17407/prometheus-wmi-exporter-grafana-windows-images/prometheus-wmi-exporter-grafana-windows-image1.png)

- Để đảm bảo các metrics đang được xuất, hãy truy cập `http://localhost:9182/metrics` trong trình duyệt của bạn trên máy chủ Windows. Bạn sẽ thấy một danh sách dài các metrics.

### 2. Cài đặt và Cấu hình Prometheus

**Mục đích**: Prometheus sẽ định kỳ thăm dò (scrape) endpoint của `windows_exporter` và lưu trữ các metrics.

**Các bước thực hiện**:
- Tải xuống Prometheus từ [trang web chính thức](https://prometheus.io/download/) và giải nén nó.
- Tạo hoặc chỉnh sửa tệp `prometheus.yml` để thêm mục tiêu Windows của bạn:


```yaml
scrape_configs:
  - job_name: 'windows'
    static_configs:
      - targets: ['WINDOWS_SERVER_IP:9182']
```


Thay thế `WINDOWS_SERVER_IP` bằng địa chỉ IP hoặc tên máy chủ Windows của bạn.

![Prometheus Configuration](https://support.boldreports.com/kb/article/17407/prometheus-wmi-exporter-grafana-windows-images/prometheus-wmi-exporter-grafana-windows-image2.png)

- Khởi động Prometheus bằng lệnh:


```bash
prometheus --config.file=prometheus.yml
```


- Truy cập `http://localhost:9090/` trong trình duyệt của bạn để kiểm tra xem Prometheus đang chạy và có thu thập được metrics từ `windows_exporter` hay không (kiểm tra dưới mục "Status" -> "Targets").

### 3. Cài đặt và Thiết lập Grafana

**Mục đích**: Grafana sẽ trực quan hóa các metrics được lưu trữ trong Prometheus.

**Các bước thực hiện**:
- Tải xuống và cài đặt Grafana từ [trang web chính thức](https://grafana.com/grafana/download/).
- Khởi chạy Grafana (theo mặc định, chạy tại `http://localhost:3000`).
- Đăng nhập (tên người dùng/mật khẩu mặc định: `admin`/`admin`).
- Thêm Prometheus làm nguồn dữ liệu:
    1. Từ menu bên trái, chọn **Configuration → Data Sources**.
    2. Nhấp vào **Add data source**, chọn **Prometheus**, và nhập địa chỉ máy chủ Prometheus (ví dụ: `http://localhost:9090` nếu Prometheus chạy trên cùng một máy).
    3. Nhấp vào **Save & Test** để xác minh kết nối.

![Grafana Add Data Source](https://support.boldreports.com/kb/article/17407/prometheus-wmi-exporter-grafana-windows-images/prometheus-wmi-exporter-grafana-windows-image3.png)

### 4. Nhập hoặc Tạo Dashboards

**Mục đích**: Trực quan hóa dữ liệu từ Prometheus.

**Nhập Dashboard có sẵn**:
- Trong Grafana, đi tới **Dashboards → Import**.
- Nhập ID dashboard cho Windows Exporter (ví dụ: **14532** cho giám sát IIS, hoặc tìm kiếm trên [Grafana Labs](https://grafana.com/grafana/dashboards/) với từ khóa "windows_exporter" để tìm các dashboard tổng quát hơn), hoặc tải lên một tệp JSON cho một dashboard `windows_exporter` chung.
- Gán dashboard đã nhập cho nguồn dữ liệu Prometheus của bạn.

**Tạo Custom Dashboards (Tùy chọn)**:
- Sử dụng giao diện người dùng của Grafana để thêm các bảng điều khiển (panels).
- Đặt các truy vấn dựa trên các metrics được xuất bởi `windows_exporter` (ví dụ: `wmi_cpu_time_total`, `wmi_logical_disk_free_bytes`, v.v.).

### 5. Trực quan hóa và Giám sát

- Điều hướng đến dashboard mới của bạn hoặc dashboard đã nhập và quan sát các metrics máy chủ Windows theo thời gian thực như CPU, bộ nhớ, ổ đĩa và trạng thái dịch vụ.
- Thiết lập cảnh báo trong Grafana nếu cần thiết để nhận thông báo về các ngưỡng hiệu suất hoặc sự cố.

![Grafana Windows Dashboard](https://support.boldreports.com/kb/article/17407/prometheus-wmi-exporter-grafana-windows-images/prometheus-wmi-exporter-grafana-windows-image4.png)

### Kết luận

Việc giám sát máy chủ Windows với Grafana, Prometheus và `windows_exporter` cung cấp một giải pháp mạnh mẽ và linh hoạt. Nó không chỉ giúp bạn theo dõi hiệu suất hệ thống một cách chi tiết mà còn cho phép bạn phản ứng nhanh chóng với các vấn đề tiềm ẩn, từ đó nâng cao độ tin cậy và hiệu quả hoạt động của hạ tầng Windows. Với các bước hướng dẫn cụ thể và hình ảnh minh họa, hy vọng bạn có thể dễ dàng triển khai hệ thống giám sát này và tối ưu hóa quy trình quản lý máy chủ của mình. Hướng nghiên cứu tiếp theo có thể bao gồm việc tích hợp thêm các công cụ như Loki để thu thập và phân tích log, hoặc Alertmanager để quản lý cảnh báo nâng cao.

## Table of Contents
- [Mở đầu](#mở-đầu)
- [Nội dung chính](#nội-dung-chính)
- [Kết luận](#kết-luận)