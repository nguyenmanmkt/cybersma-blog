---
title: "Giám Sát Máy Chủ Windows Với Grafana: Hướng Dẫn Chi Tiết"
date: 2025-09-13T12:40:33.791+07:00
draft: false
tags: ["monitoring", "grafana", "windows", "prometheus", "security", "hướng-dẫn"]
categories: ["Khoa học", "An ninh mạng", "IT Operations"]
---

Grafana là một nền tảng mã nguồn mở mạnh mẽ để phân tích, trực quan hóa và cảnh báo dữ liệu từ nhiều nguồn khác nhau. Trong môi trường IT hiện đại, việc giám sát hiệu suất và tình trạng của các máy chủ là vô cùng quan trọng để đảm bảo hoạt động liên tục và ổn định. Bài viết này sẽ đi sâu vào cách triển khai hệ thống giám sát cho máy chủ Windows bằng Grafana, kết hợp với các công cụ thu thập dữ liệu như Windows Exporter (hoặc Grafana Alloy) và Prometheus.

![Hình ảnh minh họa: Một dashboard Grafana hiển thị các chỉ số giám sát máy chủ Windows, bao gồm CPU, RAM, Disk I/O, Network.](https://grafana.com/static/img/solutions/windows-monitoring-overview.png)

## Mở đầu

Việc giám sát máy chủ Windows bao gồm thu thập các chỉ số hiệu suất (CPU, bộ nhớ, ổ đĩa, mạng) và nhật ký sự kiện, sau đó trực quan hóa chúng để dễ dàng nhận diện các vấn đề tiềm ẩn hoặc các xu hướng bất thường. Mục tiêu chính là cung cấp cái nhìn tổng thể về sức khỏe hệ thống, giúp các quản trị viên IT phản ứng kịp thời và chủ động trong việc duy trì hiệu suất. Giải pháp sử dụng Grafana kết hợp với các công cụ thu thập dữ liệu sẽ cung cấp một hệ thống giám sát toàn diện và linh hoạt.

Các khái niệm cốt lõi bao gồm:
*   **Thu thập Metrics:** Thu thập dữ liệu hiệu suất, mức sử dụng tài nguyên và nhật ký sự kiện từ máy chủ Windows.
*   **Cơ sở dữ liệu chuỗi thời gian:** Lưu trữ các chỉ số (thường là Prometheus hoặc thông qua giải pháp được quản lý của Grafana).
*   **Dashboards:** Trực quan hóa dữ liệu đã thu thập bằng cách sử dụng các bảng/đồ thị được tạo sẵn hoặc tùy chỉnh.
*   **Cảnh báo:** Kích hoạt cảnh báo dựa trên ngưỡng hoặc sự bất thường trong các giá trị chỉ số [Nguồn: Grafana Labs].

## Nội dung chính

Để giám sát máy chủ Windows bằng Grafana, chúng ta sẽ xây dựng một kiến trúc bao gồm:
1.  **Windows Exporter (hoặc Grafana Alloy):** Agent được cài đặt trên máy chủ Windows để thu thập các chỉ số.
2.  **Prometheus:** Cơ sở dữ liệu chuỗi thời gian sẽ "scrape" (thu thập) dữ liệu từ Windows Exporter.
3.  **Grafana:** Nền tảng trực quan hóa và dashboard, kết nối với Prometheus để hiển thị dữ liệu.

### 1. Cài đặt và cấu hình Windows Exporter trên máy chủ Windows

Windows Exporter là một agent mã nguồn mở được thiết kế để xuất các chỉ số hiệu suất của Windows dưới định dạng mà Prometheus có thể hiểu được.

**Bước 1: Tải xuống Windows Exporter**
Truy cập trang GitHub của Windows Exporter và tải xuống phiên bản `.msi` mới nhất phù hợp với kiến trúc hệ thống của bạn (x64).
[https://github.com/prometheus-community/windows_exporter/releases](https://github.com/prometheus-community/windows_exporter/releases)

**Bước 2: Cài đặt Windows Exporter**
Chạy file `.msi` đã tải xuống. Quá trình cài đặt rất đơn giản, chỉ cần nhấn "Next" cho đến khi hoàn tất. Theo mặc định, Windows Exporter sẽ chạy như một dịch vụ và lắng nghe trên cổng `9182`.

**Bước 3: Xác minh hoạt động của Windows Exporter**
Mở trình duyệt trên máy chủ Windows hoặc từ một máy khác có thể truy cập máy chủ đó, điều hướng đến `http://<IP_May_Chu_Windows>:9182/metrics`. Bạn sẽ thấy một trang hiển thị rất nhiều chỉ số hiệu suất của máy chủ.

### 2. Cài đặt và cấu hình Prometheus

Prometheus là một hệ thống giám sát và cảnh báo mã nguồn mở, chuyên thu thập và lưu trữ các chỉ số dưới dạng chuỗi thời gian.

**Bước 1: Tải xuống Prometheus**
Truy cập trang tải xuống của Prometheus và tải xuống phiên bản mới nhất cho hệ điều hành của bạn (ví dụ: Linux, Windows).
[https://prometheus.io/download/](https://prometheus.io/download/)

**Bước 2: Giải nén Prometheus**
Giải nén file đã tải xuống vào một thư mục mong muốn (ví dụ: `C:\Prometheus` trên Windows hoặc `/opt/prometheus` trên Linux).

**Bước 3: Cấu hình Prometheus để thu thập dữ liệu từ Windows Exporter**
Chỉnh sửa file `prometheus.yml` trong thư mục Prometheus. Thêm một `job` mới trong phần `scrape_configs` để Prometheus biết cách thu thập dữ liệu từ Windows Exporter.


```yaml
# my global config
global:
  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
  evaluation_interval: 15s # Evaluate rules every 15 seconds. Default is every 1 minute.
  # scrape_timeout is set to the global default (10s).

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# Load rules once and periodically evaluate them against the currently active set of data.
rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

# A list of scrape configurations.
scrape_configs:
  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
  - job_name: "prometheus"

    # metrics_path defaults to '/metrics'
    # scheme defaults to 'http'.

    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "windows_servers"
    static_configs:
      - targets: ["<IP_May_Chu_Windows>:9182"] # Thay <IP_May_Chu_Windows> bằng IP thực tế
        labels:
          instance: "windows-server-01" # Tên gợi nhớ cho máy chủ
```

**Lưu ý:** Thay `<IP_May_Chu_Windows>` bằng địa chỉ IP hoặc hostname của máy chủ Windows nơi bạn đã cài đặt Windows Exporter.

**Bước 4: Khởi động Prometheus**
Mở Command Prompt (hoặc Terminal trên Linux), điều hướng đến thư mục Prometheus và chạy lệnh sau:


```bash
prometheus.exe --config.file=prometheus.yml
```


Xác minh Prometheus đang chạy và không có lỗi cấu hình. Mở trình duyệt và truy cập `http://localhost:9090` (hoặc IP của máy Prometheus nếu chạy trên máy khác) để vào giao diện web của Prometheus. Trong mục "Status" -> "Targets", bạn sẽ thấy `windows_servers` với trạng thái "UP".

### 3. Cài đặt và cấu hình Grafana

Grafana là nền tảng trực quan hóa dữ liệu mà chúng ta sẽ sử dụng để tạo các dashboard giám sát.

**Bước 1: Tải xuống và cài đặt Grafana**
Truy cập trang tải xuống của Grafana và chọn phiên bản phù hợp với hệ điều hành của bạn (ví dụ: Windows Installer).
[https://grafana.com/grafana/download](https://grafana.com/grafana/download/)

Chạy file cài đặt và làm theo hướng dẫn. Theo mặc định, Grafana sẽ chạy trên cổng `3000`.

**Bước 2: Khởi động Grafana và truy cập giao diện web**
Sau khi cài đặt, Grafana sẽ tự động chạy như một dịch vụ. Mở trình duyệt và truy cập `http://localhost:3000`.
Đăng nhập với thông tin mặc định:
*   Username: `admin`
*   Password: `admin`
Bạn sẽ được yêu cầu đổi mật khẩu sau lần đăng nhập đầu tiên.

**Bước 3: Thêm Prometheus làm Data Source trong Grafana**
Trong giao diện Grafana, điều hướng đến "Connections" (biểu tượng phích cắm) -> "Add new connection".
Tìm kiếm và chọn "Prometheus".

Cấu hình Data Source Prometheus:
*   **Name:** `Prometheus` (hoặc tên bất kỳ bạn muốn)
*   **URL:** `http://localhost:9090` (hoặc địa chỉ IP của máy chủ Prometheus nếu nó chạy trên một máy khác)
*   **Access:** `Server (default)`

Nhấn "Save & Test". Nếu thành công, bạn sẽ thấy thông báo "Data source is working".

**Bước 4: Import Dashboard giám sát Windows**
Grafana có một thư viện lớn các dashboard được cộng đồng chia sẻ. Chúng ta sẽ import một dashboard đã được tạo sẵn để giám sát Windows Exporter.

Truy cập [Grafana Dashboards](https://grafana.com/grafana/dashboards/) và tìm kiếm "Windows Exporter".
Một dashboard phổ biến là "Windows Exporter - All Metrics" (ID: 10467).

Trong Grafana, điều hướng đến "Dashboards" (biểu tượng hình vuông) -> "New dashboard" -> "Import".
Nhập ID của dashboard (ví dụ: `10467`) vào ô "Import via grafana.com".
Nhấn "Load".

Trên màn hình tiếp theo:
*   **Name:** Giữ nguyên hoặc đổi tên dashboard.
*   **Folder:** Chọn thư mục lưu trữ dashboard.
*   **Prometheus:** Chọn Data Source Prometheus mà bạn đã cấu hình ở bước trước.

Nhấn "Import". Bạn sẽ thấy dashboard Windows Exporter được hiển thị với các biểu đồ về CPU, bộ nhớ, ổ đĩa, mạng và các chỉ số khác từ máy chủ Windows của bạn.

![Hình ảnh minh họa: Một dashboard Grafana hiển thị các chỉ số giám sát máy chủ Windows, bao gồm CPU, RAM, Disk I/O, Network.](https://grafana.com/static/img/solutions/windows-monitoring-overview.png)
*Tạm thời không thể tải hình ảnh minh họa nổi bật trực tiếp từ nguồn. Vui lòng tham khảo ảnh minh họa về dashboard Grafana dành cho Windows trên trang chủ của Grafana.*

### 4. Cấu hình Grafana Alloy (Tùy chọn nâng cao)

Grafana Alloy là một agent thu thập dữ liệu hiện đại, có thể thay thế Windows Exporter và cung cấp khả năng thu thập cả metrics và logs.

**Bước 1: Clone kho lưu trữ `alloy-scenarios`**

```bash
git clone https://github.com/grafana/alloy-scenarios.git
```


**Bước 2: Triển khai với Docker Compose (ví dụ cho môi trường thử nghiệm)**
Điều hướng đến thư mục `alloy-scenarios/windows` và chạy:

```bash
docker compose up -d
```

Điều này sẽ khởi động một stack bao gồm Alloy, Prometheus và Grafana.

**Bước 3: Cài đặt và cấu hình Alloy trên máy chủ Windows**
Tải xuống và cài đặt Grafana Alloy trên máy chủ Windows. Thay thế `config.alloy` mặc định bằng cấu hình kịch bản phù hợp từ kho lưu trữ `alloy-scenarios`. Khởi động dịch vụ Alloy.

Để biết thêm chi tiết, tham khảo tài liệu chính thức của Grafana Alloy: [https://grafana.com/docs/alloy/latest/monitor/monitor-windows/](https://grafana.com/docs/alloy/latest/monitor/monitor-windows/)

### 5. Cảnh báo trong Grafana

Grafana cho phép bạn thiết lập các cảnh báo dựa trên ngưỡng hoặc mẫu dữ liệu để thông báo khi có vấn đề.

**Bước 1: Tạo Alert Rule**
Trong Grafana, đi đến "Alerting" -> "Alert rules" -> "New alert rule".
*   **Rule name:** Đặt tên cho rule (ví dụ: `High CPU Usage - Windows Server 01`).
*   **Query:** Viết PromQL query để lấy dữ liệu bạn muốn giám sát (ví dụ: `windows_cpu_time_total{instance="windows-server-01", mode="idle"} < 20`).
*   **Threshold:** Đặt ngưỡng kích hoạt cảnh báo.
*   **Evaluation behavior:** Cấu hình tần suất kiểm tra và thời gian giữ trạng thái cảnh báo trước khi kích hoạt.

**Bước 2: Cấu hình Contact Point (Kênh thông báo)**
Trong "Alerting" -> "Contact points" -> "New contact point".
Cấu hình kênh thông báo (ví dụ: Email, Slack, Microsoft Teams, PagerDuty).
*   **Email:** Nhập địa chỉ email và cấu hình SMTP.
*   **Slack:** Cung cấp Slack Webhook URL.

**Bước 3: Tạo Notification Policy**
Trong "Alerting" -> "Notification policies".
Tạo một policy để chỉ định các rule nào sẽ gửi cảnh báo đến contact point nào.

## Kết luận

Giám sát máy chủ Windows với Grafana, Prometheus và Windows Exporter (hoặc Grafana Alloy) cung cấp một giải pháp mạnh mẽ và linh hoạt. Hệ thống này không chỉ giúp trực quan hóa các chỉ số hiệu suất quan trọng mà còn cho phép thiết lập cảnh báo chủ động, giúp các tổ chức duy trì sự ổn định và hiệu quả của hạ tầng IT. Việc áp dụng giải pháp này sẽ nâng cao khả năng phản ứng nhanh chóng trước các sự cố và tối ưu hóa hiệu suất hệ thống.

## Table of Contents
- [Mở đầu](#mở-đầu)
- [Nội dung chính](#nội-dung-chính)
- [Kết luận](#kết-luận)