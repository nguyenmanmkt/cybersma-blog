---
title: "Hướng Dẫn Giám Sát Máy Chủ Windows Với Grafana, Prometheus và Windows Exporter"
date: 2025-09-13T13:13:11.710+07:00
draft: false
tags: ["monitoring", "grafana", "prometheus", "windows_exporter", "an_ninh_mạng", "hướng_dẫn"]
categories: ["An ninh mạng", "Công nghệ thông tin"]
---

![Grafana Windows Servers Overview dashboard](images/2025/grafana-intro3.jpg)

Trong bối cảnh quản lý hạ tầng công nghệ thông tin ngày càng phức tạp, việc giám sát hiệu suất và trạng thái của các máy chủ là vô cùng quan trọng. Đặc biệt, đối với các hệ thống dựa trên Windows Server, một giải pháp giám sát toàn diện giúp phát hiện sớm các vấn đề, tối ưu hóa tài nguyên và đảm bảo tính liên tục của dịch vụ. Bài viết này sẽ đi sâu vào việc triển khai một hệ thống giám sát mạnh mẽ cho máy chủ Windows bằng sự kết hợp của Grafana, Prometheus và Windows Exporter – một bộ công cụ mã nguồn mở được cộng đồng IT tin dùng. Chúng ta sẽ cùng tìm hiểu về kiến trúc, cách cài đặt và cấu hình để có thể trực quan hóa các chỉ số quan trọng một cách hiệu quả.

**Tổng quan về Kiến trúc Giám sát:**

Để giám sát một máy chủ Windows, chúng ta sẽ sử dụng một kiến trúc bao gồm ba thành phần chính:

*   **windows_exporter** (trước đây là WMI Exporter): Đây là tác nhân (agent) được cài đặt trên mỗi máy chủ Windows mà bạn muốn giám sát. Nó có nhiệm vụ thu thập các chỉ số hiệu suất khác nhau như CPU, bộ nhớ, ổ đĩa, mạng và thông tin hệ thống, sau đó cung cấp chúng qua một endpoint HTTP theo định dạng mà Prometheus có thể đọc được. [Nguồn: Grafana Labs]
*   **Prometheus**: Là một bộ công cụ giám sát và cảnh báo mã nguồn mở. Prometheus định kỳ "scrape" (thu thập) các chỉ số từ các endpoint của windows_exporter và lưu trữ chúng vào cơ sở dữ liệu chuỗi thời gian (timeseries database) của mình. [Nguồn: Better Stack]
*   **Grafana**: Nền tảng trực quan hóa cho phép bạn kết nối với Prometheus như một nguồn dữ liệu. Grafana giúp xây dựng các bảng điều khiển (dashboards) tương tác để hiển thị dữ liệu hiệu suất và sức khỏe máy chủ theo thời gian thực và lịch sử. [Nguồn: Grafana Labs]

**Cách thức hoạt động:**

1.  **Cài đặt windows_exporter:** Cài đặt `windows_exporter` trên mỗi máy chủ Windows cần giám sát. Mặc định, nó sẽ cung cấp các chỉ số tại `http://localhost:9182/metrics`.
2.  **Cấu hình Prometheus:** Cấu hình Prometheus để định kỳ thu thập các chỉ số từ các endpoint của `windows_exporter` trên các máy chủ Windows.
3.  **Thiết lập Grafana:** Thiết lập Grafana, thêm Prometheus làm nguồn dữ liệu. Sau đó, bạn có thể nhập các bảng điều khiển có sẵn từ cộng đồng (ví dụ: "Windows Servers Overview" trên Grafana Labs) hoặc tự xây dựng các bảng điều khiển tùy chỉnh để trực quan hóa các chỉ số. [Nguồn: Grafana Labs]

**Các chỉ số quan trọng trong bảng điều khiển giám sát Windows Server:**

Một bảng điều khiển giám sát Windows Server hiệu quả thường bao gồm các tính năng sau:

*   Tóm tắt trạng thái của tất cả các máy chủ được giám sát, với khả năng sắp xếp theo tình trạng sức khỏe, tên máy chủ, phiên bản hệ điều hành, RAM khả dụng, mức sử dụng ổ đĩa và thời gian khởi động lại gần đây.
*   Trực quan hóa ngưỡng để làm nổi bật các máy chủ đang gặp sự cố hoặc cạn kiệt tài nguyên.
*   Các liên kết chi tiết theo tên máy chủ để xem thông tin cụ thể của từng máy chủ. [Nguồn: Grafana Labs]

### Hướng dẫn cài đặt và cấu hình Monitoring cho máy chủ Windows

Để triển khai hệ thống giám sát này, chúng ta sẽ thực hiện các bước sau:

#### Bước 1: Cài đặt Prometheus và Grafana Server (trên một máy chủ Linux hoặc riêng biệt)

Giả sử bạn đã có một máy chủ Linux để chạy Prometheus và Grafana.

**Cài đặt Prometheus:**

1.  **Tạo người dùng Prometheus:**

    
```bash
    sudo useradd --no-create-home --shell /bin/false prometheus
    sudo mkdir /etc/prometheus
    sudo mkdir /var/lib/prometheus
    sudo chown prometheus:prometheus /var/lib/prometheus
    ```


2.  **Tải xuống và cài đặt Prometheus:**

    Kiểm tra phiên bản Prometheus mới nhất trên trang chủ của Prometheus.
    
```bash
    wget https://github.com/prometheus/prometheus/releases/download/v2.x.x/prometheus-2.x.x.linux-amd64.tar.gz # Thay v2.x.x bằng phiên bản mới nhất
    tar xvf prometheus-2.x.x.linux-amd64.tar.gz
    sudo mv prometheus-2.x.x.linux-amd64 /opt/prometheus-2.x.x
    sudo ln -s /opt/prometheus-2.x.x /opt/prometheus
    sudo chown -R prometheus:prometheus /opt/prometheus-2.x.x
    sudo chown -R prometheus:prometheus /opt/prometheus
    ```


3.  **Cấu hình Prometheus:**

    Tạo file cấu hình `/etc/prometheus/prometheus.yml`:
    
```yaml
    global:
      scrape_interval: 15s

    scrape_configs:
      - job_name: 'prometheus'
        static_configs:
          - targets: ['localhost:9090']
    ```


    Chuyển quyền sở hữu file cấu hình:
    
```bash
    sudo chown prometheus:prometheus /etc/prometheus/prometheus.yml
    ```


4.  **Tạo Systemd service cho Prometheus:**

    Tạo file `/etc/systemd/system/prometheus.service`:
    
```ini
    [Unit]
    Description=Prometheus
    Wants=network-online.target
    After=network-online.target

    [Service]
    User=prometheus
    Group=prometheus
    Type=simple
    ExecStart=/opt/prometheus/prometheus --config.file /etc/prometheus/prometheus.yml --storage.tsdb.path /var/lib/prometheus/
    Restart=always

    [Install]
    WantedBy=multi-user.target
    ```


5.  **Khởi động Prometheus:**

    
```bash
    sudo systemctl daemon-reload
    sudo systemctl start prometheus
    sudo systemctl enable prometheus
    sudo systemctl status prometheus
    ```


    Bạn có thể truy cập Prometheus UI tại `http://<IP_Prometheus_Server>:9090`.

**Cài đặt Grafana:**

1.  **Thêm key GPG của Grafana:**

    
```bash
    sudo apt-get install -y apt-transport-https software-properties-common wget
    wget -q -O - https://apt.grafana.com/gpg.key | sudo apt-key add -
    ```


2.  **Thêm kho lưu trữ Grafana:**

    
```bash
    echo "deb https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
    ```


3.  **Cập nhật apt và cài đặt Grafana:**

    
```bash
    sudo apt-get update
    sudo apt-get install grafana
    ```


4.  **Khởi động Grafana:**

    
```bash
    sudo systemctl daemon-reload
    sudo systemctl start grafana-server
    sudo systemctl enable grafana-server
    sudo systemctl status grafana-server
    ```


    Bạn có thể truy cập Grafana UI tại `http://<IP_Grafana_Server>:3000` (mặc định user/pass: `admin/admin`).

#### Bước 2: Cài đặt Windows Exporter trên máy chủ Windows

1.  **Tải xuống Windows Exporter:**

    Truy cập trang [GitHub của Windows Exporter](https://github.com/prometheus-community/windows_exporter/releases) và tải xuống phiên bản `.msi` mới nhất.

2.  **Cài đặt Windows Exporter:**

    Chạy file `.msi` đã tải xuống. Bạn có thể cài đặt với các tùy chọn mặc định. `windows_exporter` sẽ được cài đặt dưới dạng một dịch vụ Windows và lắng nghe trên cổng `9182`.

3.  **Kiểm tra Windows Exporter:**

    Mở trình duyệt trên máy chủ Windows và truy cập `http://localhost:9182/metrics`. Bạn sẽ thấy một danh sách dài các chỉ số mà exporter đang thu thập.

#### Bước 3: Cấu hình Prometheus để thu thập dữ liệu từ Windows Exporter

Trên máy chủ Prometheus, chỉnh sửa file cấu hình `prometheus.yml` (ví dụ: `/etc/prometheus/prometheus.yml`) và thêm một `job` mới cho máy chủ Windows của bạn:


```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'windows_servers'
    static_configs:
      - targets: ['<IP_May_Chu_Windows_1>:9182', '<IP_May_Chu_Windows_2>:9182'] # Thay bằng IP thực tế của máy chủ Windows
```


Lưu file và khởi động lại Prometheus:


```bash
sudo systemctl restart prometheus
```


Kiểm tra trạng thái của các mục tiêu (targets) trong Prometheus UI (`http://<IP_Prometheus_Server>:9090/targets`). Bạn sẽ thấy các máy chủ Windows của mình với trạng thái "UP".

#### Bước 4: Cấu hình Grafana và tạo Dashboard

1.  **Thêm Prometheus làm Data Source trong Grafana:**

    *   Đăng nhập vào Grafana UI (`http://<IP_Grafana_Server>:3000`).
    *   Vào **Configuration (biểu tượng bánh răng) > Data Sources**.
    *   Nhấp vào **Add data source**.
    *   Chọn **Prometheus**.
    *   Trong trường **URL**, nhập `http://localhost:9090` (hoặc IP của máy chủ Prometheus).
    *   Nhấp vào **Save & Test**. Bạn sẽ thấy thông báo "Data source is working".

2.  **Import Dashboard cho Windows Server:**

    Grafana cung cấp một kho lưu trữ lớn các dashboard cộng đồng. Bạn có thể sử dụng dashboard "Windows Servers Overview" (ID: 21204) để bắt đầu.

    *   Trong Grafana, vào **Dashboards (biểu tượng 4 ô vuông) > Import**.
    *   Trong trường **Import via grafana.com**, nhập `21204`.
    *   Nhấp vào **Load**.
    *   Chọn nguồn dữ liệu Prometheus bạn vừa cấu hình.
    *   Nhấp vào **Import**.

    Bạn sẽ thấy một dashboard tổng quan về các máy chủ Windows của mình, hiển thị các chỉ số như CPU usage, Memory usage, Disk I/O, Network traffic, v.v.

### Kết luận

Việc triển khai hệ thống giám sát máy chủ Windows với Grafana, Prometheus và Windows Exporter mang lại cái nhìn toàn diện và thời gian thực về hiệu suất và tình trạng của hạ tầng. Với khả năng thu thập dữ liệu chi tiết, lưu trữ hiệu quả và trực quan hóa mạnh mẽ, giải pháp này giúp các quản trị viên hệ thống dễ dàng xác định và khắc phục sự cố, tối ưu hóa tài nguyên và đảm bảo hoạt động ổn định cho các dịch vụ quan trọng. Việc tận dụng các dashboard cộng đồng sẵn có cũng giúp rút ngắn thời gian triển khai và mang lại hiệu quả tức thì.

## Table of Contents
- [Mở đầu](#)
- [Nội dung chính](#hướng-dẫn-cài-đặt-và-cấu-hình-monitoring-cho-máy-chủ-windows)
- [Kết luận](#kết-luận)